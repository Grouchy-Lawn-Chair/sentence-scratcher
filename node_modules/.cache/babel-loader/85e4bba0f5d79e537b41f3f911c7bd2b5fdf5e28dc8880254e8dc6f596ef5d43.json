{"ast":null,"code":"// src/TiptapEditor.jsx\nimport React,{useEffect,useState,useCallback}from\"react\";import{useEditor,EditorContent}from\"@tiptap/react\";import StarterKit from\"@tiptap/starter-kit\";import Highlight from\"@tiptap/extension-highlight\";import{analyzeSentence,countWords,countSentences,calculateFleschKincaidGrade,calculateFleschReadingEase}from\"./readabilityUtils\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function TiptapEditor(_ref){let{targetGrade}=_ref;const[stats,setStats]=useState({wordCount:0,sentenceCount:0,grade:0,ease:0});// initialize editor with StarterKit + Highlight\nconst editor=useEditor({extensions:[StarterKit,Highlight],content:\"<p>Start typing here…</p>\",editorProps:{attributes:{class:\"prose max-w-none p-4 border rounded bg-white focus:outline-none\"}}});// debounce helper\nfunction debounce(fn,ms){let timer;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}clearTimeout(timer);timer=setTimeout(()=>fn(...args),ms);};}// the actual highlight + stats logic\nconst doAnalysisAndHighlight=useCallback(()=>{if(!editor)return;const text=editor.getText();// 1) update stats\nsetStats({wordCount:countWords(text),sentenceCount:countSentences(text),grade:calculateFleschKincaidGrade(text),ease:calculateFleschReadingEase(text)});// 2) clear old highlights\neditor.chain().focus().unsetHighlight().run();// 3) walk through each sentence in the *plain* text\nlet offset=0;const sentences=text.match(/[^.!?…]+[.!?…]*/g)||[];for(let sentence of sentences){const trimmed=sentence.trim();const{grade,wordCount}=analyzeSentence(trimmed);// decide color\nlet color=null;if(wordCount>=25)color=\"blue\";else if(grade>targetGrade+2)color=\"red\";else if(grade>targetGrade)color=\"yellow\";if(color){// find start/end in the document\nconst start=text.indexOf(trimmed,offset)+1;const end=start+trimmed.length;editor.chain().focus().setTextSelection({from:start,to:end}).toggleHighlight({color}).run();// add tooltip on the mark node\n// ProseMirror doesn't let us mutate attrs easily here,\n// but the Highlight extension writes a <mark data-highlight-color=\"...\">.\n// We rely on our CSS `[title]` support.\n// So instead we reselect and wrap in mark with title:\neditor.chain().focus().setTextSelection({from:start,to:end}).extendMarkRange(\"highlight\").setNodeAttribute(\"highlight\",\"title\",`Grade ${grade.toFixed(1)}, ${wordCount} words—try splitting it`).run();}offset+=sentence.length;}// reset cursor to start of document to avoid jumping\neditor.chain().focus().setTextSelection({from:text.length}).run();},[editor,targetGrade]);// debounce it to 300ms after last keystroke\nconst debouncedHighlight=useCallback(debounce(doAnalysisAndHighlight,300),[doAnalysisAndHighlight]);// wire up onUpdate → debounce\nuseEffect(()=>{if(!editor)return;editor.on(\"update\",debouncedHighlight);// do an initial pass\ndebouncedHighlight();return()=>editor.off(\"update\",debouncedHighlight);},[editor,debouncedHighlight]);if(!editor)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleBold().run(),className:\"btn\",children:\"Bold\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleItalic().run(),className:\"btn\",children:\"Italic\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleHeading({level:1}).run(),className:\"btn\",children:\"H1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleBulletList().run(),className:\"btn\",children:\"\\u2022 List\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleOrderedList().run(),className:\"btn\",children:\"1. List\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-100 px-2 py-1 rounded\",children:[\"Words: \",stats.wordCount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-100 px-2 py-1 rounded\",children:[\"Sentences: \",stats.sentenceCount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-100 px-2 py-1 rounded\",children:[\"Grade: \",stats.grade.toFixed(1)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-100 px-2 py-1 rounded\",children:[\"Ease: \",stats.ease.toFixed(1)]})]}),/*#__PURE__*/_jsx(EditorContent,{editor:editor})]});}","map":{"version":3,"names":["React","useEffect","useState","useCallback","useEditor","EditorContent","StarterKit","Highlight","analyzeSentence","countWords","countSentences","calculateFleschKincaidGrade","calculateFleschReadingEase","jsx","_jsx","jsxs","_jsxs","TiptapEditor","_ref","targetGrade","stats","setStats","wordCount","sentenceCount","grade","ease","editor","extensions","content","editorProps","attributes","class","debounce","fn","ms","timer","_len","arguments","length","args","Array","_key","clearTimeout","setTimeout","doAnalysisAndHighlight","text","getText","chain","focus","unsetHighlight","run","offset","sentences","match","sentence","trimmed","trim","color","start","indexOf","end","setTextSelection","from","to","toggleHighlight","extendMarkRange","setNodeAttribute","toFixed","debouncedHighlight","on","off","className","children","onClick","toggleBold","toggleItalic","toggleHeading","level","toggleBulletList","toggleOrderedList"],"sources":["C:/Users/Mitchell/Downloads/Hemming Way App Clone/Hemming Way App Clone/src/TiptapEditor.jsx"],"sourcesContent":["// src/TiptapEditor.jsx\r\n\r\nimport React, { useEffect, useState, useCallback } from \"react\";\r\nimport { useEditor, EditorContent } from \"@tiptap/react\";\r\nimport StarterKit from \"@tiptap/starter-kit\";\r\nimport Highlight from \"@tiptap/extension-highlight\";\r\nimport {\r\n  analyzeSentence,\r\n  countWords,\r\n  countSentences,\r\n  calculateFleschKincaidGrade,\r\n  calculateFleschReadingEase,\r\n} from \"./readabilityUtils\";\r\n\r\nexport default function TiptapEditor({ targetGrade }) {\r\n  const [stats, setStats] = useState({\r\n    wordCount: 0,\r\n    sentenceCount: 0,\r\n    grade: 0,\r\n    ease: 0,\r\n  });\r\n\r\n  // initialize editor with StarterKit + Highlight\r\n  const editor = useEditor({\r\n    extensions: [StarterKit, Highlight],\r\n    content: \"<p>Start typing here…</p>\",\r\n    editorProps: {\r\n      attributes: {\r\n        class:\r\n          \"prose max-w-none p-4 border rounded bg-white focus:outline-none\",\r\n      },\r\n    },\r\n  });\r\n\r\n  // debounce helper\r\n  function debounce(fn, ms) {\r\n    let timer;\r\n    return (...args) => {\r\n      clearTimeout(timer);\r\n      timer = setTimeout(() => fn(...args), ms);\r\n    };\r\n  }\r\n\r\n  // the actual highlight + stats logic\r\n  const doAnalysisAndHighlight = useCallback(() => {\r\n    if (!editor) return;\r\n    const text = editor.getText();\r\n\r\n    // 1) update stats\r\n    setStats({\r\n      wordCount: countWords(text),\r\n      sentenceCount: countSentences(text),\r\n      grade: calculateFleschKincaidGrade(text),\r\n      ease: calculateFleschReadingEase(text),\r\n    });\r\n\r\n    // 2) clear old highlights\r\n    editor.chain().focus().unsetHighlight().run();\r\n\r\n    // 3) walk through each sentence in the *plain* text\r\n    let offset = 0;\r\n    const sentences = text.match(/[^.!?…]+[.!?…]*/g) || [];\r\n    for (let sentence of sentences) {\r\n      const trimmed = sentence.trim();\r\n      const { grade, wordCount } = analyzeSentence(trimmed);\r\n\r\n      // decide color\r\n      let color = null;\r\n      if (wordCount >= 25) color = \"blue\";\r\n      else if (grade > targetGrade + 2) color = \"red\";\r\n      else if (grade > targetGrade) color = \"yellow\";\r\n\r\n      if (color) {\r\n        // find start/end in the document\r\n        const start = text.indexOf(trimmed, offset) + 1;\r\n        const end = start + trimmed.length;\r\n\r\n        editor\r\n          .chain()\r\n          .focus()\r\n          .setTextSelection({ from: start, to: end })\r\n          .toggleHighlight({ color })\r\n          .run();\r\n\r\n        // add tooltip on the mark node\r\n        // ProseMirror doesn't let us mutate attrs easily here,\r\n        // but the Highlight extension writes a <mark data-highlight-color=\"...\">.\r\n        // We rely on our CSS `[title]` support.\r\n        // So instead we reselect and wrap in mark with title:\r\n        editor\r\n          .chain()\r\n          .focus()\r\n          .setTextSelection({ from: start, to: end })\r\n          .extendMarkRange(\"highlight\")\r\n          .setNodeAttribute(\"highlight\", \"title\", \r\n            `Grade ${grade.toFixed(1)}, ${wordCount} words—try splitting it`\r\n          )\r\n          .run();\r\n      }\r\n\r\n      offset += sentence.length;\r\n    }\r\n\r\n    // reset cursor to start of document to avoid jumping\r\n    editor.chain().focus().setTextSelection({ from: text.length }).run();\r\n  }, [editor, targetGrade]);\r\n\r\n  // debounce it to 300ms after last keystroke\r\n  const debouncedHighlight = useCallback(debounce(doAnalysisAndHighlight, 300), [\r\n    doAnalysisAndHighlight,\r\n  ]);\r\n\r\n  // wire up onUpdate → debounce\r\n  useEffect(() => {\r\n    if (!editor) return;\r\n    editor.on(\"update\", debouncedHighlight);\r\n    // do an initial pass\r\n    debouncedHighlight();\r\n    return () => editor.off(\"update\", debouncedHighlight);\r\n  }, [editor, debouncedHighlight]);\r\n\r\n  if (!editor) return null;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Toolbar */}\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        <button onClick={() => editor.chain().focus().toggleBold().run()} className=\"btn\">\r\n          Bold\r\n        </button>\r\n        <button onClick={() => editor.chain().focus().toggleItalic().run()} className=\"btn\">\r\n          Italic\r\n        </button>\r\n        <button\r\n          onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}\r\n          className=\"btn\"\r\n        >\r\n          H1\r\n        </button>\r\n        <button\r\n          onClick={() => editor.chain().focus().toggleBulletList().run()}\r\n          className=\"btn\"\r\n        >\r\n          • List\r\n        </button>\r\n        <button\r\n          onClick={() => editor.chain().focus().toggleOrderedList().run()}\r\n          className=\"btn\"\r\n        >\r\n          1. List\r\n        </button>\r\n      </div>\r\n\r\n      {/* Stats */}\r\n      <div className=\"flex flex-wrap gap-4 text-sm\">\r\n        <div className=\"bg-gray-100 px-2 py-1 rounded\">Words: {stats.wordCount}</div>\r\n        <div className=\"bg-gray-100 px-2 py-1 rounded\">Sentences: {stats.sentenceCount}</div>\r\n        <div className=\"bg-green-100 px-2 py-1 rounded\">Grade: {stats.grade.toFixed(1)}</div>\r\n        <div className=\"bg-blue-100 px-2 py-1 rounded\">Ease: {stats.ease.toFixed(1)}</div>\r\n      </div>\r\n\r\n      {/* Editor */}\r\n      <EditorContent editor={editor} />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}