{"ast":null,"code":"// src/TiptapEditor.jsx\nimport\"use-sync-external-store/shim\";import React,{useEffect,useState,useCallback,useRef}from\"react\";import{useEditor,EditorContent}from\"@tiptap/react\";import StarterKit from\"@tiptap/starter-kit\";import Highlight from\"@tiptap/extension-highlight\";import Placeholder from\"@tiptap/extension-placeholder\";import{Mark,mergeAttributes}from\"@tiptap/core\";import{analyzeSentence,countWords,countSentences,calculateFleschKincaidGrade,calculateFleschReadingEase}from\"./readabilityUtils\";import{SIMPLE_WORD_MAP}from\"./simpleWordMap\";// Settings\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ENABLE_BLUE=false;// leave off, you can flip to true later\n// length thresholds\nconst LONG_SENTENCE_WORDS=15;// blue only if ENABLE_BLUE is true\nconst HEMI_HARD_WORDS=20;// yellow if length 20+\nconst HEMI_VERY_HARD_WORDS=25;// red if length 25+\n// grade delta thresholds, guard with floors so short sentences are not noisy\nconst DELTA_HARD=1;// yellow if grade > target + 1 AND words >= 14\nconst DELTA_VERY_HARD=3;// red if grade > target + 3 AND words >= 18\nconst MIN_YELLOW_WORDS_FOR_GRADE=14;const MIN_RED_WORDS_FOR_GRADE=18;const DEBOUNCE_MS=200;// highlight colors\nconst COLOR_MAP={yellow:{bg:\"#fff3b0\",border:\"#facc15\"},red:{bg:\"#ffd1d1\",border:\"#f87171\"},blue:{bg:\"#dbeafe\",border:\"#93c5fd\"}};// Dale–Chall syllable gates per target\nconst HARD_SYLLABLES_BY_TARGET={6:3,8:4,10:5};// Extend Highlight to allow data-tip on the sentence mark\nconst TipHighlight=Highlight.extend({addAttributes(){var _this$parent;return{...((_this$parent=this.parent)===null||_this$parent===void 0?void 0:_this$parent.call(this)),dataTip:{default:null,renderHTML:attrs=>attrs.dataTip?{\"data-tip\":attrs.dataTip}:{}}};}});// New, a mark for hard words with a purple dotted underline\nconst HardWordMark=Mark.create({name:\"hardWord\",inclusive:false,group:\"inline\",parseHTML(){return[{tag:'span[data-hard-word=\"1\"]'}];},renderHTML(_ref){let{HTMLAttributes}=_ref;return[\"span\",mergeAttributes({\"data-hard-word\":\"1\"},HTMLAttributes),0];},addAttributes(){return{dataTip:{default:null,renderHTML:attrs=>attrs.dataTip?{\"data-tip\":attrs.dataTip}:{}},style:{default:\"text-decoration-line: underline; text-decoration-style: dotted; text-decoration-color: #7c3aed; text-decoration-thickness: 2px;\"}};}});export default function TiptapEditor(_ref2){let{targetGrade}=_ref2;const[stats,setStats]=useState({wordCount:0,sentenceCount:0,grade:0,ease:0});const[showHardWords,setShowHardWords]=useState(()=>{try{return localStorage.getItem(\"ssShowHard\")!==\"0\";}catch{return true;}});const[easySet,setEasySet]=useState(()=>new Set(MIN_EASY_WORDS));// fallback until JSON loads\nconst lastSignature=useRef(\"\");const editor=useEditor({extensions:[StarterKit,TipHighlight.configure({multicolor:true}),HardWordMark,Placeholder.configure({placeholder:\"Start typing, or paste your text here\",includeChildren:true})],content:\"\",editorProps:{attributes:{class:\"editor-content prose prose-sm sm:prose lg:prose-lg xl:prose-xl max-w-none p-4 border rounded bg-white focus:outline-none\"}}});// load Dale–Chall list from /public once\nuseEffect(()=>{fetch(process.env.PUBLIC_URL+\"/daleChallEasyWords.json\").then(r=>r.ok?r.json():[]).then(list=>{if(Array.isArray(list)&&list.length)setEasySet(new Set(list.map(w=>w.toLowerCase())));}).catch(()=>{});},[]);// utility, debounce\nconst debounce=(fn,ms)=>{let t;return function(){for(var _len=arguments.length,a=new Array(_len),_key=0;_key<_len;_key++){a[_key]=arguments[_key];}clearTimeout(t);t=setTimeout(()=>fn(...a),ms);};};// Decide sentence color\nconst classify=(words,grade,target)=>{const delta=grade-target;if(words>=HEMI_VERY_HARD_WORDS)return\"red\";if(words>=HEMI_HARD_WORDS)return\"yellow\";if(delta>DELTA_VERY_HARD&&words>=MIN_RED_WORDS_FOR_GRADE)return\"red\";if(delta>DELTA_HARD&&words>=MIN_YELLOW_WORDS_FOR_GRADE)return\"yellow\";if(ENABLE_BLUE&&words>=LONG_SENTENCE_WORDS)return\"blue\";return null;};// Case smart suggestion, preserves caps\nconst smartCase=(orig,simple)=>{if(!simple)return\"\";if(orig===orig.toUpperCase())return simple.toUpperCase();if(orig[0]===orig[0].toUpperCase())return simple[0].toUpperCase()+simple.slice(1);return simple;};// quick syllable estimate for single words\nconst syllables=word=>{const w=word.toLowerCase().replace(/[^a-z']/g,\"\");if(!w)return 0;// quick exceptions\nconst exceptions=[\"queue\",\"people\",\"business\",\"every\",\"family\",\"chocolate\"];if(exceptions.includes(w))return{queue:2,people:2,business:2,every:2,family:3,chocolate:3}[w]||1;let count=0;const vowels=\"aeiouy\";for(let i=0;i<w.length;i++){if(vowels.includes(w[i])&&!vowels.includes(w[i-1]||\"\"))count++;}// silent e\nif(w.endsWith(\"e\"))count--;// minimum 1\nreturn Math.max(1,count);};// word tests\nconst isAllCaps=w=>w.length>1&&w===w.toUpperCase();const isUrlLike=w=>/^https?:\\/\\//i.test(w)||/^www\\./i.test(w);const isNumberLike=w=>/^\\d/.test(w);const isLikelyProperNoun=w=>/^[A-Z][a-z]/.test(w)&&!isAllCaps(w);// Apply sentence highlight\nconst applySentenceHighlight=(from,to,color,tip)=>{const cfg=COLOR_MAP[color];if(!cfg)return;editor.chain().setTextSelection({from,to}).setHighlight({color:cfg.bg,dataTip:tip,HTMLAttributes:{style:`background-color:${cfg.bg}; border:1px solid ${cfg.border}; border-radius:2px; padding:0 0.08em; color:inherit;`}}).run();};// Apply a hard word underline\nconst applyHardWordMark=(from,to,tip)=>{editor.chain().setTextSelection({from,to}).setMark(\"hardWord\",{dataTip:tip}).run();};// Tooltip copy for sentences\nconst tooltipMessage=(color,_ref3)=>{let{byLengthHard,byLengthYellow,byDeltaHard,byDeltaYellow}=_ref3;if(color===\"red\"){if(byLengthHard&&byDeltaHard)return\"Very hard, long and above target, split and simplify.\";if(byLengthHard)return\"Very hard, 25 or more words, split this sentence.\";if(byDeltaHard)return\"Very hard, about 3 grades over target, split and simplify.\";}if(color===\"yellow\"){if(byLengthYellow&&byDeltaYellow)return\"A bit long and above your target, consider a small rewrite.\";if(byLengthYellow)return\"A bit long, 20 or more words, consider a split.\";if(byDeltaYellow)return\"Slightly above your target, try simpler words or a split.\";}if(color===\"blue\"){return\"Long sentence, consider a split.\";}return\"\";};// main analyzer\nconst analyzeAndHighlight=useCallback(()=>{if(!editor)return;const fullText=editor.getText();const signature=[fullText.length,targetGrade,ENABLE_BLUE,showHardWords?1:0,easySet.size// re analyze when list loads\n].join(\":\");if(signature===lastSignature.current)return;lastSignature.current=signature;// update totals\nsetStats({wordCount:countWords(fullText),sentenceCount:countSentences(fullText),grade:calculateFleschKincaidGrade(fullText),ease:calculateFleschReadingEase(fullText)});// clear existing marks\neditor.chain().focus().unsetHighlight().unsetMark(\"hardWord\").run();const{doc}=editor.state;doc.descendants((node,pos)=>{const isBlock=[\"paragraph\",\"list_item\",\"heading\"].includes(node.type.name);if(!isBlock)return;const text=node.textContent;if(!text)return;// split into sentences keeping punctuation\nconst parts=text.match(/[^.!?…]+[.!?…]*/g)||[];let searchFrom=0;for(const raw of parts){const s=raw.trim();if(!s){searchFrom+=raw.length;continue;}// sentence metrics\nconst{wordCount,syllableCount,grade}=analyzeSentence(s);void syllableCount;// not used directly here\nconst color=classify(wordCount,grade,targetGrade);// locate sentence in node text\nconst startInNode=text.indexOf(s,searchFrom);if(startInNode===-1){searchFrom+=raw.length;continue;}const sentFrom=pos+1+startInNode;const sentTo=sentFrom+s.length;// reasons for tooltip\nconst delta=grade-targetGrade;const byLengthHard=wordCount>=HEMI_VERY_HARD_WORDS;const byLengthYellow=wordCount>=HEMI_HARD_WORDS;const byDeltaHard=delta>DELTA_VERY_HARD&&wordCount>=MIN_RED_WORDS_FOR_GRADE;const byDeltaYellow=delta>DELTA_HARD&&wordCount>=MIN_YELLOW_WORDS_FOR_GRADE;if(color){const tip=tooltipMessage(color,{byLengthHard,byLengthYellow,byDeltaHard,byDeltaYellow});applySentenceHighlight(sentFrom,sentTo,color,tip);}// hard word pass\nif(showHardWords){var _HARD_SYLLABLES_BY_TA;const thresh=(_HARD_SYLLABLES_BY_TA=HARD_SYLLABLES_BY_TARGET[targetGrade])!==null&&_HARD_SYLLABLES_BY_TA!==void 0?_HARD_SYLLABLES_BY_TA:3;// find word tokens within the sentence string\nconst wordRegex=/\\b[\\w'-]+\\b/g;let m,tokenIndex=0;while((m=wordRegex.exec(s))!==null){const wOrig=m[0];const w=wOrig.replace(/^'+|'+$/g,\"\");// trim stray quotes\nconst lower=w.toLowerCase();// skip trivial or non words\nif(!w||isUrlLike(w)||isNumberLike(w)){tokenIndex++;continue;}if(tokenIndex>0&&isLikelyProperNoun(wOrig)){tokenIndex++;continue;}if(isAllCaps(wOrig)){tokenIndex++;continue;}// Dale–Chall easy check\nconst isEasy=easySet.has(lower);const syl=syllables(w);const isHardBySyll=syl>=thresh;if(!isEasy&&isHardBySyll){// suggestion if we have one\nconst simple=SIMPLE_WORD_MAP[lower];const suggestion=simple?smartCase(wOrig,simple):null;const tip=suggestion?`Likely hard word, try “${suggestion}”.`:\"Likely hard word, consider a simpler option.\";const from=sentFrom+m.index;const to=from+wOrig.length;applyHardWordMark(from,to,tip);}tokenIndex++;}}searchFrom=startInNode+s.length;}});// keep caret at end\neditor.chain().focus().setTextSelection({from:fullText.length}).run();},[editor,targetGrade,showHardWords,easySet]);const debounced=useCallback(debounce(analyzeAndHighlight,DEBOUNCE_MS),[analyzeAndHighlight]);useEffect(()=>{if(!editor)return;editor.on(\"update\",debounced);debounced();// first pass\nreturn()=>editor.off(\"update\",debounced);},[editor,debounced]);// singleton tooltip that follows the mouse for any element with data-tip\nuseEffect(()=>{if(!editor)return;const root=editor.view.dom;let tip=document.getElementById(\"ss-tooltip\");if(!tip){tip=document.createElement(\"div\");tip.id=\"ss-tooltip\";Object.assign(tip.style,{position:\"fixed\",zIndex:\"9999\",maxWidth:\"28rem\",padding:\"6px 8px\",fontSize:\"12px\",lineHeight:\"1.25\",color:\"#111827\",background:\"#f9fafb\",border:\"1px solid #e5e7eb\",borderRadius:\"4px\",boxShadow:\"0 4px 10px rgba(0,0,0,.08)\",pointerEvents:\"none\",display:\"none\"});document.body.appendChild(tip);}const show=(e,text)=>{tip.textContent=text||\"\";tip.style.left=`${e.clientX+10}px`;tip.style.top=`${e.clientY+12}px`;tip.style.display=text?\"block\":\"none\";};const hide=()=>{tip.style.display=\"none\";};const onMove=e=>{const el=e.target.closest('[data-tip]');if(el&&root.contains(el)){show(e,el.getAttribute(\"data-tip\")||\"\");}else{hide();}};if(!root.dataset.ssTipAttached){root.addEventListener(\"mousemove\",onMove);root.addEventListener(\"mouseleave\",hide);root.dataset.ssTipAttached=\"true\";}return()=>{root.removeEventListener(\"mousemove\",onMove);root.removeEventListener(\"mouseleave\",hide);delete root.dataset.ssTipAttached;hide();};},[editor]);// persist the hard word toggle\nuseEffect(()=>{try{localStorage.setItem(\"ssShowHard\",showHardWords?\"1\":\"0\");}catch{}if(!showHardWords&&editor){editor.chain().unsetMark(\"hardWord\").run();}else{debounced();}},[showHardWords]);// eslint-disable-line\nif(!editor)return null;// stats display, show dashes when empty\nconst hasText=stats.wordCount>0&&stats.sentenceCount>0;const gradeDisplay=hasText?stats.grade.toFixed(1):\"—\";const easeDisplay=hasText?stats.ease.toFixed(1):\"—\";return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-2 mb-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleBold().run(),className:\"px-2 py-1 border rounded\",children:\"Bold\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleItalic().run(),className:\"px-2 py-1 border rounded\",children:\"Italic\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleHeading({level:1}).run(),className:\"px-2 py-1 border rounded\",children:\"H1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleBulletList().run(),className:\"px-2 py-1 border rounded\",children:\"\\u2022 List\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>editor.chain().focus().toggleOrderedList().run(),className:\"px-2 py-1 border rounded\",children:\"1. List\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4 text-xs mb-2 items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-red w-3 h-3 border inline-block\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Very hard, 25+ words, or grade +3 with 18+ words\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-yellow w-3 h-3 border inline-block\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Slightly over, 20+ words, or grade +1 with 14+ words\"})]}),ENABLE_BLUE&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"legend-blue w-3 h-3 border inline-block\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Long, 15+ words\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2 ml-auto\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"inline-flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:showHardWords,onChange:e=>setShowHardWords(e.target.checked)}),/*#__PURE__*/_jsx(\"span\",{className:\"legend-underline-purple\",children:\"Aa\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Likely hard word\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-100 px-2 py-1 rounded\",children:[\"Words, \",stats.wordCount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-100 px-2 py-1 rounded\",children:[\"Sentences, \",stats.sentenceCount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-100 px-2 py-1 rounded\",children:[\"Grade, \",gradeDisplay]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-100 px-2 py-1 rounded\",children:[\"Ease, \",easeDisplay]})]}),/*#__PURE__*/_jsx(EditorContent,{editor:editor})]});}/* minimal fallback words so nothing crashes before the JSON loads */const MIN_EASY_WORDS=[\"a\",\"about\",\"after\",\"all\",\"also\",\"an\",\"and\",\"any\",\"are\",\"as\",\"at\",\"back\",\"be\",\"because\",\"been\",\"before\",\"but\",\"by\",\"can\",\"come\",\"could\",\"day\",\"did\",\"do\",\"down\",\"each\",\"even\",\"every\",\"few\",\"find\",\"first\",\"for\",\"from\",\"get\",\"go\",\"good\",\"had\",\"has\",\"have\",\"he\",\"her\",\"here\",\"him\",\"his\",\"how\",\"i\",\"if\",\"in\",\"into\",\"is\",\"it\",\"just\",\"know\",\"like\",\"little\",\"long\",\"look\",\"made\",\"make\",\"man\",\"many\",\"may\",\"me\",\"men\",\"more\",\"most\",\"much\",\"must\",\"my\",\"new\",\"no\",\"not\",\"now\",\"of\",\"off\",\"old\",\"on\",\"one\",\"only\",\"or\",\"other\",\"our\",\"out\",\"over\",\"people\",\"right\",\"said\",\"see\",\"she\",\"so\",\"some\",\"than\",\"that\",\"the\",\"their\",\"them\",\"then\",\"there\",\"these\",\"they\",\"this\",\"time\",\"to\",\"two\",\"up\",\"us\",\"use\",\"very\",\"want\",\"was\",\"way\",\"we\",\"well\",\"went\",\"were\",\"what\",\"when\",\"where\",\"which\",\"who\",\"will\",\"with\",\"work\",\"would\",\"year\",\"years\",\"you\",\"your\"];","map":{"version":3,"names":["React","useEffect","useState","useCallback","useRef","useEditor","EditorContent","StarterKit","Highlight","Placeholder","Mark","mergeAttributes","analyzeSentence","countWords","countSentences","calculateFleschKincaidGrade","calculateFleschReadingEase","SIMPLE_WORD_MAP","jsx","_jsx","jsxs","_jsxs","ENABLE_BLUE","LONG_SENTENCE_WORDS","HEMI_HARD_WORDS","HEMI_VERY_HARD_WORDS","DELTA_HARD","DELTA_VERY_HARD","MIN_YELLOW_WORDS_FOR_GRADE","MIN_RED_WORDS_FOR_GRADE","DEBOUNCE_MS","COLOR_MAP","yellow","bg","border","red","blue","HARD_SYLLABLES_BY_TARGET","TipHighlight","extend","addAttributes","_this$parent","parent","call","dataTip","default","renderHTML","attrs","HardWordMark","create","name","inclusive","group","parseHTML","tag","_ref","HTMLAttributes","style","TiptapEditor","_ref2","targetGrade","stats","setStats","wordCount","sentenceCount","grade","ease","showHardWords","setShowHardWords","localStorage","getItem","easySet","setEasySet","Set","MIN_EASY_WORDS","lastSignature","editor","extensions","configure","multicolor","placeholder","includeChildren","content","editorProps","attributes","class","fetch","process","env","PUBLIC_URL","then","r","ok","json","list","Array","isArray","length","map","w","toLowerCase","catch","debounce","fn","ms","t","_len","arguments","a","_key","clearTimeout","setTimeout","classify","words","target","delta","smartCase","orig","simple","toUpperCase","slice","syllables","word","replace","exceptions","includes","queue","people","business","every","family","chocolate","count","vowels","i","endsWith","Math","max","isAllCaps","isUrlLike","test","isNumberLike","isLikelyProperNoun","applySentenceHighlight","from","to","color","tip","cfg","chain","setTextSelection","setHighlight","run","applyHardWordMark","setMark","tooltipMessage","_ref3","byLengthHard","byLengthYellow","byDeltaHard","byDeltaYellow","analyzeAndHighlight","fullText","getText","signature","size","join","current","focus","unsetHighlight","unsetMark","doc","state","descendants","node","pos","isBlock","type","text","textContent","parts","match","searchFrom","raw","s","trim","syllableCount","startInNode","indexOf","sentFrom","sentTo","_HARD_SYLLABLES_BY_TA","thresh","wordRegex","m","tokenIndex","exec","wOrig","lower","isEasy","has","syl","isHardBySyll","suggestion","index","debounced","on","off","root","view","dom","document","getElementById","createElement","id","Object","assign","position","zIndex","maxWidth","padding","fontSize","lineHeight","background","borderRadius","boxShadow","pointerEvents","display","body","appendChild","show","e","left","clientX","top","clientY","hide","onMove","el","closest","contains","getAttribute","dataset","ssTipAttached","addEventListener","removeEventListener","setItem","hasText","gradeDisplay","toFixed","easeDisplay","className","children","onClick","toggleBold","toggleItalic","toggleHeading","level","toggleBulletList","toggleOrderedList","checked","onChange"],"sources":["C:/Users/Mitchell/Downloads/Hemming Way App Clone/Hemming Way App Clone/src/TiptapEditor.jsx"],"sourcesContent":["// src/TiptapEditor.jsx\r\n\r\nimport \"use-sync-external-store/shim\";\r\nimport React, { useEffect, useState, useCallback, useRef } from \"react\";\r\nimport { useEditor, EditorContent } from \"@tiptap/react\";\r\nimport StarterKit from \"@tiptap/starter-kit\";\r\nimport Highlight from \"@tiptap/extension-highlight\";\r\nimport Placeholder from \"@tiptap/extension-placeholder\";\r\nimport { Mark, mergeAttributes } from \"@tiptap/core\";\r\nimport {\r\n  analyzeSentence,\r\n  countWords,\r\n  countSentences,\r\n  calculateFleschKincaidGrade,\r\n  calculateFleschReadingEase,\r\n} from \"./readabilityUtils\";\r\nimport { SIMPLE_WORD_MAP } from \"./simpleWordMap\";\r\n\r\n// Settings\r\nconst ENABLE_BLUE = false; // leave off, you can flip to true later\r\n\r\n// length thresholds\r\nconst LONG_SENTENCE_WORDS = 15;  // blue only if ENABLE_BLUE is true\r\nconst HEMI_HARD_WORDS = 20;      // yellow if length 20+\r\nconst HEMI_VERY_HARD_WORDS = 25; // red if length 25+\r\n\r\n// grade delta thresholds, guard with floors so short sentences are not noisy\r\nconst DELTA_HARD = 1;            // yellow if grade > target + 1 AND words >= 14\r\nconst DELTA_VERY_HARD = 3;       // red if grade > target + 3 AND words >= 18\r\nconst MIN_YELLOW_WORDS_FOR_GRADE = 14;\r\nconst MIN_RED_WORDS_FOR_GRADE = 18;\r\n\r\nconst DEBOUNCE_MS = 200;\r\n\r\n// highlight colors\r\nconst COLOR_MAP = {\r\n  yellow: { bg: \"#fff3b0\", border: \"#facc15\" },\r\n  red:    { bg: \"#ffd1d1\", border: \"#f87171\" },\r\n  blue:   { bg: \"#dbeafe\", border: \"#93c5fd\" },\r\n};\r\n\r\n// Dale–Chall syllable gates per target\r\nconst HARD_SYLLABLES_BY_TARGET = {\r\n  6: 3,\r\n  8: 4,\r\n  10: 5,\r\n};\r\n\r\n// Extend Highlight to allow data-tip on the sentence mark\r\nconst TipHighlight = Highlight.extend({\r\n  addAttributes() {\r\n    return {\r\n      ...this.parent?.(),\r\n      dataTip: {\r\n        default: null,\r\n        renderHTML: attrs => (attrs.dataTip ? { \"data-tip\": attrs.dataTip } : {}),\r\n      },\r\n    };\r\n  },\r\n});\r\n\r\n// New, a mark for hard words with a purple dotted underline\r\nconst HardWordMark = Mark.create({\r\n  name: \"hardWord\",\r\n  inclusive: false,\r\n  group: \"inline\",\r\n  parseHTML() {\r\n    return [{ tag: 'span[data-hard-word=\"1\"]' }];\r\n  },\r\n  renderHTML({ HTMLAttributes }) {\r\n    return [\"span\", mergeAttributes({ \"data-hard-word\": \"1\" }, HTMLAttributes), 0];\r\n  },\r\n  addAttributes() {\r\n    return {\r\n      dataTip: {\r\n        default: null,\r\n        renderHTML: attrs => (attrs.dataTip ? { \"data-tip\": attrs.dataTip } : {}),\r\n      },\r\n      style: {\r\n        default:\r\n          \"text-decoration-line: underline; text-decoration-style: dotted; text-decoration-color: #7c3aed; text-decoration-thickness: 2px;\",\r\n      },\r\n    };\r\n  },\r\n});\r\n\r\nexport default function TiptapEditor({ targetGrade }) {\r\n  const [stats, setStats] = useState({ wordCount: 0, sentenceCount: 0, grade: 0, ease: 0 });\r\n  const [showHardWords, setShowHardWords] = useState(() => {\r\n    try { return localStorage.getItem(\"ssShowHard\") !== \"0\"; } catch { return true; }\r\n  });\r\n  const [easySet, setEasySet] = useState(() => new Set(MIN_EASY_WORDS)); // fallback until JSON loads\r\n  const lastSignature = useRef(\"\");\r\n\r\n  const editor = useEditor({\r\n    extensions: [\r\n      StarterKit,\r\n      TipHighlight.configure({ multicolor: true }),\r\n      HardWordMark,\r\n      Placeholder.configure({\r\n        placeholder: \"Start typing, or paste your text here\",\r\n        includeChildren: true,\r\n      }),\r\n    ],\r\n    content: \"\",\r\n    editorProps: {\r\n      attributes: {\r\n        class:\r\n          \"editor-content prose prose-sm sm:prose lg:prose-lg xl:prose-xl max-w-none p-4 border rounded bg-white focus:outline-none\",\r\n      },\r\n    },\r\n  });\r\n\r\n  // load Dale–Chall list from /public once\r\n  useEffect(() => {\r\n    fetch(process.env.PUBLIC_URL + \"/daleChallEasyWords.json\")\r\n      .then(r => r.ok ? r.json() : [])\r\n      .then(list => {\r\n        if (Array.isArray(list) && list.length) setEasySet(new Set(list.map(w => w.toLowerCase())));\r\n      })\r\n      .catch(() => {});\r\n  }, []);\r\n\r\n  // utility, debounce\r\n  const debounce = (fn, ms) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; };\r\n\r\n  // Decide sentence color\r\n  const classify = (words, grade, target) => {\r\n    const delta = grade - target;\r\n    if (words >= HEMI_VERY_HARD_WORDS) return \"red\";\r\n    if (words >= HEMI_HARD_WORDS) return \"yellow\";\r\n    if (delta > DELTA_VERY_HARD && words >= MIN_RED_WORDS_FOR_GRADE) return \"red\";\r\n    if (delta > DELTA_HARD && words >= MIN_YELLOW_WORDS_FOR_GRADE) return \"yellow\";\r\n    if (ENABLE_BLUE && words >= LONG_SENTENCE_WORDS) return \"blue\";\r\n    return null;\r\n  };\r\n\r\n  // Case smart suggestion, preserves caps\r\n  const smartCase = (orig, simple) => {\r\n    if (!simple) return \"\";\r\n    if (orig === orig.toUpperCase()) return simple.toUpperCase();\r\n    if (orig[0] === orig[0].toUpperCase()) return simple[0].toUpperCase() + simple.slice(1);\r\n    return simple;\r\n  };\r\n\r\n  // quick syllable estimate for single words\r\n  const syllables = (word) => {\r\n    const w = word.toLowerCase().replace(/[^a-z']/g, \"\");\r\n    if (!w) return 0;\r\n    // quick exceptions\r\n    const exceptions = [\"queue\", \"people\", \"business\", \"every\", \"family\", \"chocolate\"];\r\n    if (exceptions.includes(w)) return { queue: 2, people: 2, business: 2, every: 2, family: 3, chocolate: 3 }[w] || 1;\r\n    let count = 0;\r\n    const vowels = \"aeiouy\";\r\n    for (let i = 0; i < w.length; i++) {\r\n      if (vowels.includes(w[i]) && !vowels.includes(w[i - 1] || \"\")) count++;\r\n    }\r\n    // silent e\r\n    if (w.endsWith(\"e\")) count--;\r\n    // minimum 1\r\n    return Math.max(1, count);\r\n  };\r\n\r\n  // word tests\r\n  const isAllCaps = (w) => w.length > 1 && w === w.toUpperCase();\r\n  const isUrlLike = (w) => /^https?:\\/\\//i.test(w) || /^www\\./i.test(w);\r\n  const isNumberLike = (w) => /^\\d/.test(w);\r\n  const isLikelyProperNoun = (w) => /^[A-Z][a-z]/.test(w) && !isAllCaps(w);\r\n\r\n  // Apply sentence highlight\r\n  const applySentenceHighlight = (from, to, color, tip) => {\r\n    const cfg = COLOR_MAP[color]; if (!cfg) return;\r\n    editor.chain().setTextSelection({ from, to }).setHighlight({\r\n      color: cfg.bg,\r\n      dataTip: tip,\r\n      HTMLAttributes: {\r\n        style: `background-color:${cfg.bg}; border:1px solid ${cfg.border}; border-radius:2px; padding:0 0.08em; color:inherit;`,\r\n      },\r\n    }).run();\r\n  };\r\n\r\n  // Apply a hard word underline\r\n  const applyHardWordMark = (from, to, tip) => {\r\n    editor.chain().setTextSelection({ from, to }).setMark(\"hardWord\", {\r\n      dataTip: tip,\r\n    }).run();\r\n  };\r\n\r\n  // Tooltip copy for sentences\r\n  const tooltipMessage = (color, { byLengthHard, byLengthYellow, byDeltaHard, byDeltaYellow }) => {\r\n    if (color === \"red\") {\r\n      if (byLengthHard && byDeltaHard) return \"Very hard, long and above target, split and simplify.\";\r\n      if (byLengthHard) return \"Very hard, 25 or more words, split this sentence.\";\r\n      if (byDeltaHard) return \"Very hard, about 3 grades over target, split and simplify.\";\r\n    }\r\n    if (color === \"yellow\") {\r\n      if (byLengthYellow && byDeltaYellow) return \"A bit long and above your target, consider a small rewrite.\";\r\n      if (byLengthYellow) return \"A bit long, 20 or more words, consider a split.\";\r\n      if (byDeltaYellow) return \"Slightly above your target, try simpler words or a split.\";\r\n    }\r\n    if (color === \"blue\") {\r\n      return \"Long sentence, consider a split.\";\r\n    }\r\n    return \"\";\r\n  };\r\n\r\n  // main analyzer\r\n  const analyzeAndHighlight = useCallback(() => {\r\n    if (!editor) return;\r\n\r\n    const fullText = editor.getText();\r\n    const signature = [\r\n      fullText.length,\r\n      targetGrade,\r\n      ENABLE_BLUE,\r\n      showHardWords ? 1 : 0,\r\n      easySet.size, // re analyze when list loads\r\n    ].join(\":\");\r\n    if (signature === lastSignature.current) return;\r\n    lastSignature.current = signature;\r\n\r\n    // update totals\r\n    setStats({\r\n      wordCount: countWords(fullText),\r\n      sentenceCount: countSentences(fullText),\r\n      grade: calculateFleschKincaidGrade(fullText),\r\n      ease: calculateFleschReadingEase(fullText),\r\n    });\r\n\r\n    // clear existing marks\r\n    editor.chain().focus().unsetHighlight().unsetMark(\"hardWord\").run();\r\n\r\n    const { doc } = editor.state;\r\n\r\n    doc.descendants((node, pos) => {\r\n      const isBlock = [\"paragraph\", \"list_item\", \"heading\"].includes(node.type.name);\r\n      if (!isBlock) return;\r\n\r\n      const text = node.textContent;\r\n      if (!text) return;\r\n\r\n      // split into sentences keeping punctuation\r\n      const parts = text.match(/[^.!?…]+[.!?…]*/g) || [];\r\n      let searchFrom = 0;\r\n\r\n      for (const raw of parts) {\r\n        const s = raw.trim();\r\n        if (!s) { searchFrom += raw.length; continue; }\r\n\r\n        // sentence metrics\r\n        const { wordCount, syllableCount, grade } = analyzeSentence(s);\r\n        void syllableCount; // not used directly here\r\n        const color = classify(wordCount, grade, targetGrade);\r\n\r\n        // locate sentence in node text\r\n        const startInNode = text.indexOf(s, searchFrom);\r\n        if (startInNode === -1) { searchFrom += raw.length; continue; }\r\n        const sentFrom = pos + 1 + startInNode;\r\n        const sentTo = sentFrom + s.length;\r\n\r\n        // reasons for tooltip\r\n        const delta = grade - targetGrade;\r\n        const byLengthHard = wordCount >= HEMI_VERY_HARD_WORDS;\r\n        const byLengthYellow = wordCount >= HEMI_HARD_WORDS;\r\n        const byDeltaHard = delta > DELTA_VERY_HARD && wordCount >= MIN_RED_WORDS_FOR_GRADE;\r\n        const byDeltaYellow = delta > DELTA_HARD && wordCount >= MIN_YELLOW_WORDS_FOR_GRADE;\r\n\r\n        if (color) {\r\n          const tip = tooltipMessage(color, { byLengthHard, byLengthYellow, byDeltaHard, byDeltaYellow });\r\n          applySentenceHighlight(sentFrom, sentTo, color, tip);\r\n        }\r\n\r\n        // hard word pass\r\n        if (showHardWords) {\r\n          const thresh = HARD_SYLLABLES_BY_TARGET[targetGrade] ?? 3;\r\n          // find word tokens within the sentence string\r\n          const wordRegex = /\\b[\\w'-]+\\b/g;\r\n          let m, tokenIndex = 0;\r\n          while ((m = wordRegex.exec(s)) !== null) {\r\n            const wOrig = m[0];\r\n            const w = wOrig.replace(/^'+|'+$/g, \"\"); // trim stray quotes\r\n            const lower = w.toLowerCase();\r\n\r\n            // skip trivial or non words\r\n            if (!w || isUrlLike(w) || isNumberLike(w)) { tokenIndex++; continue; }\r\n            if (tokenIndex > 0 && isLikelyProperNoun(wOrig)) { tokenIndex++; continue; }\r\n            if (isAllCaps(wOrig)) { tokenIndex++; continue; }\r\n\r\n            // Dale–Chall easy check\r\n            const isEasy = easySet.has(lower);\r\n            const syl = syllables(w);\r\n            const isHardBySyll = syl >= thresh;\r\n\r\n            if (!isEasy && isHardBySyll) {\r\n              // suggestion if we have one\r\n              const simple = SIMPLE_WORD_MAP[lower];\r\n              const suggestion = simple ? smartCase(wOrig, simple) : null;\r\n              const tip = suggestion\r\n                ? `Likely hard word, try “${suggestion}”.`\r\n                : \"Likely hard word, consider a simpler option.\";\r\n\r\n              const from = sentFrom + m.index;\r\n              const to = from + wOrig.length;\r\n              applyHardWordMark(from, to, tip);\r\n            }\r\n\r\n            tokenIndex++;\r\n          }\r\n        }\r\n\r\n        searchFrom = startInNode + s.length;\r\n      }\r\n    });\r\n\r\n    // keep caret at end\r\n    editor.chain().focus().setTextSelection({ from: fullText.length }).run();\r\n  }, [editor, targetGrade, showHardWords, easySet]);\r\n\r\n  const debounced = useCallback(debounce(analyzeAndHighlight, DEBOUNCE_MS), [analyzeAndHighlight]);\r\n\r\n  useEffect(() => {\r\n    if (!editor) return;\r\n    editor.on(\"update\", debounced);\r\n    debounced(); // first pass\r\n    return () => editor.off(\"update\", debounced);\r\n  }, [editor, debounced]);\r\n\r\n  // singleton tooltip that follows the mouse for any element with data-tip\r\n  useEffect(() => {\r\n    if (!editor) return;\r\n    const root = editor.view.dom;\r\n\r\n    let tip = document.getElementById(\"ss-tooltip\");\r\n    if (!tip) {\r\n      tip = document.createElement(\"div\");\r\n      tip.id = \"ss-tooltip\";\r\n      Object.assign(tip.style, {\r\n        position: \"fixed\",\r\n        zIndex: \"9999\",\r\n        maxWidth: \"28rem\",\r\n        padding: \"6px 8px\",\r\n        fontSize: \"12px\",\r\n        lineHeight: \"1.25\",\r\n        color: \"#111827\",\r\n        background: \"#f9fafb\",\r\n        border: \"1px solid #e5e7eb\",\r\n        borderRadius: \"4px\",\r\n        boxShadow: \"0 4px 10px rgba(0,0,0,.08)\",\r\n        pointerEvents: \"none\",\r\n        display: \"none\",\r\n      });\r\n      document.body.appendChild(tip);\r\n    }\r\n\r\n    const show = (e, text) => {\r\n      tip.textContent = text || \"\";\r\n      tip.style.left = `${e.clientX + 10}px`;\r\n      tip.style.top = `${e.clientY + 12}px`;\r\n      tip.style.display = text ? \"block\" : \"none\";\r\n    };\r\n    const hide = () => { tip.style.display = \"none\"; };\r\n\r\n    const onMove = (e) => {\r\n      const el = e.target.closest('[data-tip]');\r\n      if (el && root.contains(el)) {\r\n        show(e, el.getAttribute(\"data-tip\") || \"\");\r\n      } else {\r\n        hide();\r\n      }\r\n    };\r\n\r\n    if (!root.dataset.ssTipAttached) {\r\n      root.addEventListener(\"mousemove\", onMove);\r\n      root.addEventListener(\"mouseleave\", hide);\r\n      root.dataset.ssTipAttached = \"true\";\r\n    }\r\n\r\n    return () => {\r\n      root.removeEventListener(\"mousemove\", onMove);\r\n      root.removeEventListener(\"mouseleave\", hide);\r\n      delete root.dataset.ssTipAttached;\r\n      hide();\r\n    };\r\n  }, [editor]);\r\n\r\n  // persist the hard word toggle\r\n  useEffect(() => {\r\n    try { localStorage.setItem(\"ssShowHard\", showHardWords ? \"1\" : \"0\"); } catch {}\r\n    if (!showHardWords && editor) {\r\n      editor.chain().unsetMark(\"hardWord\").run();\r\n    } else {\r\n      debounced();\r\n    }\r\n  }, [showHardWords]); // eslint-disable-line\r\n\r\n  if (!editor) return null;\r\n\r\n  // stats display, show dashes when empty\r\n  const hasText = stats.wordCount > 0 && stats.sentenceCount > 0;\r\n  const gradeDisplay = hasText ? stats.grade.toFixed(1) : \"—\";\r\n  const easeDisplay  = hasText ? stats.ease.toFixed(1)  : \"—\";\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* toolbar */}\r\n      <div className=\"flex flex-wrap gap-2 mb-2\">\r\n        <button onClick={() => editor.chain().focus().toggleBold().run()} className=\"px-2 py-1 border rounded\">Bold</button>\r\n        <button onClick={() => editor.chain().focus().toggleItalic().run()} className=\"px-2 py-1 border rounded\">Italic</button>\r\n        <button onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()} className=\"px-2 py-1 border rounded\">H1</button>\r\n        <button onClick={() => editor.chain().focus().toggleBulletList().run()} className=\"px-2 py-1 border rounded\">• List</button>\r\n        <button onClick={() => editor.chain().focus().toggleOrderedList().run()} className=\"px-2 py-1 border rounded\">1. List</button>\r\n      </div>\r\n\r\n{/* legend */}\r\n<div className=\"flex flex-wrap gap-4 text-xs mb-2 items-center\">\r\n  <div className=\"flex items-center gap-1\">\r\n    <span className=\"legend-red w-3 h-3 border inline-block\"></span>\r\n    <span>Very hard, 25+ words, or grade +3 with 18+ words</span>\r\n  </div>\r\n  <div className=\"flex items-center gap-1\">\r\n    <span className=\"legend-yellow w-3 h-3 border inline-block\"></span>\r\n    <span>Slightly over, 20+ words, or grade +1 with 14+ words</span>\r\n  </div>\r\n  {ENABLE_BLUE && (\r\n    <div className=\"flex items-center gap-1\">\r\n      <span className=\"legend-blue w-3 h-3 border inline-block\"></span>\r\n      <span>Long, 15+ words</span>\r\n    </div>\r\n  )}\r\n  <div className=\"flex items-center gap-2 ml-auto\">\r\n    <label className=\"inline-flex items-center gap-1\">\r\n      <input\r\n        type=\"checkbox\"\r\n        checked={showHardWords}\r\n        onChange={(e) => setShowHardWords(e.target.checked)}\r\n      />\r\n      <span className=\"legend-underline-purple\">Aa</span>\r\n      <span>Likely hard word</span>\r\n    </label>\r\n  </div>\r\n</div>\r\n\r\n      {/* stats */}\r\n      <div className=\"flex flex-wrap gap-4 text-sm\">\r\n        <div className=\"bg-gray-100 px-2 py-1 rounded\">Words, {stats.wordCount}</div>\r\n        <div className=\"bg-gray-100 px-2 py-1 rounded\">Sentences, {stats.sentenceCount}</div>\r\n        <div className=\"bg-green-100 px-2 py-1 rounded\">Grade, {gradeDisplay}</div>\r\n        <div className=\"bg-blue-100 px-2 py-1 rounded\">Ease, {easeDisplay}</div>\r\n      </div>\r\n\r\n      <EditorContent editor={editor} />\r\n    </div>\r\n  );\r\n}\r\n\r\n/* minimal fallback words so nothing crashes before the JSON loads */\r\nconst MIN_EASY_WORDS = [\r\n  \"a\",\"about\",\"after\",\"all\",\"also\",\"an\",\"and\",\"any\",\"are\",\"as\",\"at\",\"back\",\"be\",\"because\",\"been\",\"before\",\"but\",\"by\",\r\n  \"can\",\"come\",\"could\",\"day\",\"did\",\"do\",\"down\",\"each\",\"even\",\"every\",\"few\",\"find\",\"first\",\"for\",\"from\",\"get\",\"go\",\r\n  \"good\",\"had\",\"has\",\"have\",\"he\",\"her\",\"here\",\"him\",\"his\",\"how\",\"i\",\"if\",\"in\",\"into\",\"is\",\"it\",\"just\",\"know\",\"like\",\r\n  \"little\",\"long\",\"look\",\"made\",\"make\",\"man\",\"many\",\"may\",\"me\",\"men\",\"more\",\"most\",\"much\",\"must\",\"my\",\"new\",\"no\",\r\n  \"not\",\"now\",\"of\",\"off\",\"old\",\"on\",\"one\",\"only\",\"or\",\"other\",\"our\",\"out\",\"over\",\"people\",\"right\",\"said\",\"see\",\"she\",\r\n  \"so\",\"some\",\"than\",\"that\",\"the\",\"their\",\"them\",\"then\",\"there\",\"these\",\"they\",\"this\",\"time\",\"to\",\"two\",\"up\",\"us\",\r\n  \"use\",\"very\",\"want\",\"was\",\"way\",\"we\",\"well\",\"went\",\"were\",\"what\",\"when\",\"where\",\"which\",\"who\",\"will\",\"with\",\"work\",\r\n  \"would\",\"year\",\"years\",\"you\",\"your\"\r\n];\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}